# CityVibe AI - Техническая документация

## 1. Project Overview (Обзор проекта)

**Название проекта:** CityVibe AI

**Цель:** Создание интеллектуальной системы для оценки качества городской среды на основе анализа спутниковых данных и инфраструктуры.

**Какую проблему решает:** 
- Автоматизация оценки привлекательности городских локаций для проживания и инвестиций
- Объективный анализ экологической ситуации через NDVI индекс
- Оптимизация выбора недвижимости и коммерческих объектов

**Где применяется:** Городское планирование, риелторский бизнес, инвестиционный анализ, муниципальное управление.

## 2. Problem Description (Описание проблемы)

**Проблема космической индустрии:**
- Огромный объем спутниковых данных Sentinel-2 требует автоматизированной обработки
- Ручной анализ NDVI и инфраструктуры трудозатратен и субъективен
- Отсутствие интегрированных решений для комплексной оценки городской среды

**Актуальность:**
- Рост урбанизации требует эффективных инструментов оценки качества жизни
- Инвесторам и жителям нужна объективная информация о локациях
- Муниципалитетам нужны данные для планирования развития

**Почему обычные методы не решают:**
- Ручной анализ не справляется с большими объемами данных
- Традиционные ГИС-системы не используют AI для комплексной оценки
- Отсутствует интеграция спутниковых данных с наземной инфраструктурой

## 3. System Architecture (Архитектура решения)

### Основные модули:
```
User Interface (Web) → API Gateway (FastAPI) → Processing Layer
                                                    ↓
Satellite Data Processing ← NDVI Analysis ← Sentinel-2 API
                                                    ↓
Infrastructure Analysis ← OpenStreetMap/OSRM ← External APIs
                                                    ↓
AI Model (CityVibeNet) → Score Calculation → Response
```

### Компоненты системы:
- **Backend API** (FastAPI): RESTful сервер для обработки запросов
- **NDVI Module**: Анализ спутниковых снимков Sentinel-2
- **Infrastructure Module**: Анализ городской инфраструктуры через OSM
- **AI Model**: Нейронная сеть CityVibeNet для комплексной оценки
- **Frontend**: Веб-интерфейс для визуализации результатов

### Взаимодействие модулей:
1. Пользователь отправляет координаты через API
2. Система параллельно запрашивает спутниковые данные и инфраструктуру
3. AI модель обрабатывает полученные данные
4. Формируется комплексная оценка CityVibe Score
5. Результаты возвращаются пользователю с детализацией

## 4. Technology Stack (Стек технологий)

### Backend:
- **Python 3.8+**: Основной язык разработки
- **FastAPI 0.104.1**: Веб-фреймворк для API
- **Uvicorn 0.24.0**: ASGI сервер
- **Pydantic 2.5.0**: Валидация данных

### AI/ML:
- **PyTorch 2.1.0**: Фреймворк для нейронных сетей
- **NumPy 1.24.3**: Научные вычисления
- **Llama-cpp-python 0.2.23**: LLM для объяснений

### Внешние API:
- **SentinelHub 3.10.1**: Доступ к спутниковым данным Sentinel-2
- **OpenStreetMap Overpass API**: Данные об инфраструктуре
- **OSRM API**: Расчет маршрутов и времени ходьбы

### Инструменты:
- **Docker**: Контейнеризация (опционально)
- **Git**: Версионирование кода
- **Python-dotenv 1.0.0**: Управление переменными окружения

## 5. AI Component (Самое важное)

### Тип модели: CityVibeNet (Custom Neural Network)

**Архитектура:**
- **Phi слой**: Embedding для координат объектов (2 → 32 → 16)
- **Rho слой**: Комбинированная обработка (17 → 32 → 1)
- **Активация**: ReLU для скрытых слоев, Sigmoid для выхода

**Входные данные:**
- NDVI индекс (float): Нормализованный показатель озеленения
- Объекты инфраструктуры: Список с классом и временем ходьбы
  - class: ID категории (0-4: магазин, аптека, кафе, клиника, остановка)
  - walk_time: Время пешком в минутах

**Выходные данные:**
- CityVibe Score: Оценка от 0 до 100 баллов

**Обучение модели:**
- Loss function: MSE (Mean Squared Error)
- Optimizer: Adam
- Метрики: MAE, R², Accuracy (±10 баллов)

**Принцип работы:**
1. Phi слой преобразует координаты каждого объекта в embedding
2. Embeddings суммируются для создания общего вектора инфраструктуры
3. Конкатенация с NDVI создает комплексный вектор признаков
4. Rho слой вычисляет итоговую оценку привлекательности

**Почему подходит для задачи:**
- Учитывает пространственное распределение объектов
- Интегрирует экологические и инфраструктурные факторы
- Интерпретируемая архитектура для объяснения решений

## 6. Data Description (Описание данных)

### Источники данных:
- **Sentinel-2**: Спутниковые снимки через SentinelHub API
- **OpenStreetMap**: Данные об инфраструктуре и POI
- **OSRM**: Расчет времени ходьбы до объектов

### Форматы данных:
- **Спутниковые данные**: GeoTIFF, обрабатываемые в реальном времени
- **Инфраструктура**: JSON через Overpass API
- **Модель**: PyTorch .pth файл (8.7KB)

### Объем данных:
- Спутниковые снимки: Запросы по требованию (10м разрешение)
- Инфраструктура: Кэширование на 5 минут для оптимизации
- Обучающая выборка: 500+ локаций с экспертными оценками

### Предобработка:
- **NDVI**: Расчет по формуле (NIR - Red)/(NIR + Red)
- **Нормализация**: Top 30% значений NDVI для каждой локации
- **Категоризация**: 5 основных классов инфраструктуры
- **Фильтрация**: Удаление дубликатов и нерелевантных объектов

## 7. MVP Description (Описание MVP)

**Реализованные функции:**
- ✅ Анализ NDVI для радиусов 100м, 200м, 300м
- ✅ Поиск инфраструктуры в 15-минутной доступности
- ✅ Расчет CityVibe Score через нейросеть
- ✅ REST API с полной валидацией
- ✅ Веб-интерфейс с интерактивной картой
- ✅ AI-объяснение результатов через LLM

**Рабочие эндпоинты:**
- `GET /audit?lat=X&lon=Y` - Полный аудит локации
- `GET /listings?lat=X&lon=Y` - Поиск недвижимости
- `POST /explain` - AI-объяснение результатов
- `GET /place-details` - Детальная информация об объектах

**Ограничения MVP:**
- Тестовые данные для недвижимости (моковые цены)
- Отсутствие real-time обновлений спутниковых данных
- Ограничение 60 объектов в поиске недвижимости
- Fallback на прямое расстояние при недоступности OSRM

## 8. Installation & Launch Instructions (Инструкция по запуску)

### Требования:
- Python 3.8+
- SentinelHub API ключи
- Интернет соединение

### Установка:
```bash
# Клонирование репозитория
git clone https://github.com/Make-09/CityVibe_AI.git
cd CityVibe_AI

# Создание виртуального окружения
python -m venv .venv
source .venv/bin/activate  # Linux/Mac
.venv\Scripts\activate     # Windows

# Установка зависимостей
pip install -r requirements.txt
```

### Настройка:
```bash
# Создать файл api_keys.env
SH_CLIENT_ID=your_sentinelhub_client_id
SH_CLIENT_SECRET=your_sentinelhub_client_secret
GOOGLE_PLACES_API_KEY=your_google_api_key  # опционально
```

### Запуск:
```bash
# Запуск сервера
python server.py

# Сервер будет доступен по адресу:
# API: http://127.0.0.1:8000
# Docs: http://127.0.0.1:8000/docs
```


## 9. Scalability & Future Development

### Масштабирование:
- **Горизонтальное**: Микросервисная архитектура для распределенной обработки
- **Вертикальное**: Увеличение радиусов анализа и детализации спутниковых данных
- **Географическое**: Расширение на новые города и страны

### Интеграция с реальными спутниками:
- Прямое подключение к Sentinel-2 через ESA API
- Real-time обработка новых спутниковых снимков
- Интеграция с коммерческими спутниковыми провайдерами

### Облачная обработка:
- AWS Lambda/GCP Functions для serverless обработки
- Auto-scaling групп для обработки пиковых нагрузок
- CDN для кэширования спутниковых данных

### B2B API:
- Белые решения для риелторских компаний
- Municipal API для городского планирования
- Инвестиционные аналитические инструменты

## 10. Limitations

**Текущие ограничения:**
- Зависимость от доступности внешних API (SentinelHub, OSM)
- Ограниченная точность в плотной городской застройке
- Отсутствие исторического анализа динамики изменений

**Технические ограничения:**
- Модель требует дообучения на новых регионах
- Нет real-time обработки спутниковых данных
- Ограниченный набор классов инфраструктуры (5 категорий)

**Пути улучшения:**
- Расширение датасета для повышения точности
- Интеграция дополнительных источников данных
- Разработка mobile приложения для полевых исследований

---

**Контактная информация:**
- GitHub: https://github.com/Make-09/CityVibe_AI
- Документация: http://127.0.0.1:8000/docs
- Email: mbahetzan@gmail.com

**Версия:** 1.0.0
**Дата:** Февраль 2026
